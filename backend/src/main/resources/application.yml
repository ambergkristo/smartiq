spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/smartiq}
    username: ${SPRING_DATASOURCE_USERNAME:smartiq}
    password: ${SPRING_DATASOURCE_PASSWORD:}
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
  flyway:
    enabled: true
    placeholders:
      seed_core_enabled: true
  h2:
    console:
      enabled: true

management:
  prometheus:
    metrics:
      export:
        enabled: true
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: never

smartiq:
  build:
    commit-sha: ${SMARTIQ_BUILD_SHA:unknown}
    time: ${SMARTIQ_BUILD_TIME:unknown}
  import:
    enabled: ${SMARTIQ_IMPORT_ENABLED:true}
    path: ${SMARTIQ_IMPORT_PATH:../data/smart10}
  pool:
    enabled: ${SMARTIQ_POOL_ENABLED:true}
    minimum-per-key: ${MIN_BANK_SIZE:1000}
    low-watermark-per-key: ${POOL_LOW_WATERMARK:800}
    refill-target-per-key: ${POOL_TARGET:1200}
  session:
    enabled: ${SMARTIQ_SESSION_DEDUP_ENABLED:true}
    ttl-minutes: ${SMARTIQ_SESSION_TTL_MINUTES:120}
    max-sessions: ${SMARTIQ_SESSION_MAX:50000}
  bank:
    min-size: ${MIN_BANK_SIZE:1000}
    block-on-low-bank: ${SMARTIQ_BLOCK_ON_LOW_BANK:false}
    trigger-pipeline-on-low-bank: ${SMARTIQ_TRIGGER_PIPELINE_ON_LOW_BANK:false}
    pipeline-command: ${SMARTIQ_PIPELINE_COMMAND:npm run pipeline:cards}
  cors:
    allowed-origins:
      - ${SMARTIQ_CORS_ALLOWED_ORIGIN_LOCAL:http://localhost:5173}
      - ${SMARTIQ_CORS_ALLOWED_ORIGIN_PUBLIC:https://smartiq.vercel.app}
  internal-access:
    enabled: ${SMARTIQ_INTERNAL_ACCESS_ENABLED:false}
    api-key-header: ${SMARTIQ_INTERNAL_API_KEY_HEADER:X-Internal-Api-Key}
    api-key: ${SMARTIQ_INTERNAL_API_KEY:}
    protected-actuator-paths:
      - /actuator/metrics
      - /actuator/env
      - /actuator/configprops
      - /actuator/beans
  rate-limit:
    enabled: ${SMARTIQ_RATE_LIMIT_ENABLED:true}
    window-seconds: ${SMARTIQ_RATE_LIMIT_WINDOW_SECONDS:60}
    cards-next-per-minute: ${SMARTIQ_RATE_LIMIT_CARDS_NEXT_PER_MINUTE:120}
    session-answer-per-minute: ${SMARTIQ_RATE_LIMIT_SESSION_ANSWER_PER_MINUTE:180}
